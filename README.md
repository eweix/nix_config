# Nix-Darwin

Declarative control over a MacOS system using [nix-darwin][darwin] and [home-manager][hm]

[darwin]: https://github.com/nix-darwin/nix-darwin
[hm]: https://github.com/nix-community/home-manager

## Setup

1. Install [Xcode command line tools][xcode].

```bash
xcode-select --install
```

2. Install [nix][nix] using [determinate system's installer][dsi].

```bash
/bin/bash curl -fsSL https://install.determinate.systems/nix | sh -s -- install --determinate
```

3. Install [homebrew][brew].

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

4. Run `just darwin` in the root of the nix configuration to deploy the
   configuration. This may require installation of `just` using homebrew:

```bash
/bin/bash brew install maciejwalkowiak/brew/just
```

This installation may be later overwritten by nix-darwin, so make sure that just
is installed _somewhere_ on the nix configuration!

Other Just commands:

```bash
# See all available commands
just

# Clean up the nix store
just clean
just gc
```

[nix]: https://nixos.org/
[dsi]: https://github.com/DeterminateSystems/nix-installer
[brew]: https://brew.sh/
[xcode]: https://developer.apple.com/xcode/

## Configuration Structure

```bash
› tree
.
├── dotfiles # submodule with dotfiles, imported by home-manager
├── flake.lock # lock file generated by nix
├── flake.nix # entry point of nix config; need to add hostname here
├── home # home-manager's config folder
│	├── core.nix # user-level apps from nixpkgs
│	├── default.nix # home-manager entrypoint
│	├── git.nix # customize git dotfiles
│	└── shell.nix # customize zsh dotfiles
├── Justfile # Justfile defining nix-darwin workflow
├── modules
│	├── apps.nix # contains all homebrew & nix apps
│	├── host-users.nix # defines hostname & system users
│	├── nix-core.nix # nix's core config
│	└── system.nix # macOS system config
└── README.md
```

## Additional resources

- [NixOS-Guide][guide]
- Ryan Yin's [nix-darwin template][ryin]
- Dustin Lyon's [comprehensive nix configuration][dly]
- Mitchell Hashimoto's [nix dev environment][ndev]
- [Scientific-env][sci-env]
- [Running NixOS in a VM][mwid]
- [Summer of Nix][summer]
- [Practical Flake Anatomy][anatomy]

[guide]: https://github.com/mikeroyal/NixOS-Guide
[ryin]: https://github.com/ryan4yin
[dly]: https://github.com/dustinlyons/nixos-config
[ndev]: https://github.com/mitchellh/nixos-config
[sci-env]: https://github.com/Vortriz/scientific-env
[mwid]: https://mattwidmann.net/notes/running-nixos-in-a-vm/
[summer]: https://www.youtube.com/watch?v=SjjEDTccpQA&list=PLt4-_lkyRrOMWyp5G-m_d1wtTcbBaOxZk
[anatomy]: https://vtimofeenko.com/posts/practical-nix-flake-anatomy-a-guided-tour-of-flake.nix/
